!function(){"use strict";function t(){}function e(t,e){for(const n in e)t[n]=e[n];return t}function n(t){return t()}function o(){return Object.create(null)}function l(t){t.forEach(n)}function c(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function r(t,e){t.appendChild(e)}function s(t,e,n){t.insertBefore(e,n||null)}function a(t){t.parentNode.removeChild(t)}function u(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function f(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function h(){return d(" ")}function m(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function p(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function $(t,e){e=""+e,t.data!==e&&(t.data=e)}function v(t,e){(null!=e||t.value)&&(t.value=e)}function y(t,e,n){t.classList[n?"add":"remove"](e)}let b;function w(t){b=t}function x(){const t=function(){if(!b)throw new Error("Function called outside component initialization");return b}();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const l=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);o.slice().forEach(e=>{e.call(t,l)})}}}function k(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(t=>t(e))}const E=[],_=[],A=[],L=[],C=Promise.resolve();let q=!1;function M(t){A.push(t)}const N=new Set;function T(){do{for(;E.length;){const t=E.shift();w(t),j(t.$$)}for(;_.length;)_.pop()();for(let t=0;t<A.length;t+=1){const e=A[t];N.has(e)||(N.add(e),e())}A.length=0}while(E.length);for(;L.length;)L.pop()();q=!1,N.clear()}function j(t){if(null!==t.fragment){t.update(),l(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(M)}}const B=new Set;let O;function P(){O={r:0,c:[],p:O}}function S(){O.r||l(O.c),O=O.p}function R(t,e){t&&t.i&&(B.delete(t),t.i(e))}function X(t,e,n,o){if(t&&t.o){if(B.has(t))return;B.add(t),O.c.push(()=>{B.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}function z(t,e){const n={},o={},l={$$scope:1};let c=t.length;for(;c--;){const i=t[c],r=e[c];if(r){for(const t in i)t in r||(o[t]=1);for(const t in r)l[t]||(n[t]=r[t],l[t]=1);t[c]=r}else for(const t in i)l[t]=1}for(const t in o)t in n||(n[t]=void 0);return n}function D(t){return"object"==typeof t&&null!==t?t:{}}function F(t){t&&t.c()}function G(t,e,o){const{fragment:i,on_mount:r,on_destroy:s,after_update:a}=t.$$;i&&i.m(e,o),M(()=>{const e=r.map(n).filter(c);s?s.push(...e):l(e),t.$$.on_mount=[]}),a.forEach(M)}function H(t,e){const n=t.$$;null!==n.fragment&&(l(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function I(t,e){-1===t.$$.dirty[0]&&(E.push(t),q||(q=!0,C.then(T)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function U(e,n,c,i,r,s,a=[-1]){const u=b;w(e);const f=n.props||{},d=e.$$={fragment:null,ctx:null,props:s,update:t,not_equal:r,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:o(),dirty:a};let h=!1;d.ctx=c?c(e,f,(t,n,...o)=>{const l=o.length?o[0]:n;return d.ctx&&r(d.ctx[t],d.ctx[t]=l)&&(d.bound[t]&&d.bound[t](l),h&&I(e,t)),n}):[],d.update(),h=!0,l(d.before_update),d.fragment=!!i&&i(d.ctx),n.target&&(n.hydrate?d.fragment&&d.fragment.l(function(t){return Array.from(t.childNodes)}(n.target)):d.fragment&&d.fragment.c(),n.intro&&R(e.$$.fragment),G(e,n.target,n.anchor),T()),w(u)}class W{$destroy(){H(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}const J=t=>{let e={name:t.nodeName};const n=[];for(const e of t.attributes)n.push(e.value);n.length&&(e.attributes=n);const o=[];for(const e of t.children)o.push(J(e));return o.length?e.children=o:e.value=t.textContent,e};function K(t,e,n){const o=t.slice();return o[13]=e[n],o[15]=n,o}function Q(t){let e,n;return{c(){e=f("td"),n=f("i"),g(n,"class","scanex-wms-view-folder icon"),y(n,"folder-open",t[2]),y(n,"folder",!t[2])},m(t,o){s(t,e,o),r(e,n)},p(t,e){4&e&&y(n,"folder-open",t[2]),4&e&&y(n,"folder",!t[2])},d(t){t&&a(e)}}}function V(t){let e,n,o=t[0],l=[];for(let e=0;e<o.length;e+=1)l[e]=Y(K(t,o,e));const c=t=>X(l[t],1,1,()=>{l[t]=null});return{c(){e=f("div");for(let t=0;t<l.length;t+=1)l[t].c();g(e,"class","children"),y(e,"collapsed",!t[2])},m(t,o){s(t,e,o);for(let t=0;t<l.length;t+=1)l[t].m(e,null);n=!0},p(t,n){if(129&n){let i;for(o=t[0],i=0;i<o.length;i+=1){const c=K(t,o,i);l[i]?(l[i].p(c,n),R(l[i],1)):(l[i]=Y(c),l[i].c(),R(l[i],1),l[i].m(e,null))}for(P(),i=o.length;i<l.length;i+=1)c(i);S()}4&n&&y(e,"collapsed",!t[2])},i(t){if(!n){for(let t=0;t<o.length;t+=1)R(l[t]);n=!0}},o(t){l=l.filter(Boolean);for(let t=0;t<l.length;t+=1)X(l[t]);n=!1},d(t){t&&a(e),u(l,t)}}}function Y(t){let n;const o=[t[13]];let l={};for(let t=0;t<o.length;t+=1)l=e(l,o[t]);const c=new et({props:l});return c.$on("change:visible",t[11]),c.$on("change:state",(function(...e){return t[12](t[15],...e)})),{c(){F(c.$$.fragment)},m(t,e){G(c,t,e),n=!0},p(e,n){t=e;const l=1&n?z(o,[D(t[13])]):{};c.$set(l)},i(t){n||(R(c.$$.fragment,t),n=!0)},o(t){X(c.$$.fragment,t),n=!1},d(t){H(c,t)}}}function Z(t){let e,n,o,c,i,u,v,b,w,x,k,E,_=Array.isArray(t[0])&&t[0].length>0,A=t[4]&&Q(t),L=_&&V(t);return{c(){e=f("div"),n=f("table"),o=f("tr"),c=f("td"),i=f("i"),u=h(),A&&A.c(),v=h(),b=f("td"),w=d(t[1]),x=h(),L&&L.c(),g(i,"class","scanex-wms-view-visible icon"),y(i,"check-square",1===t[3]),y(i,"square",0===t[3]),y(i,"minus-square",-1===t[3]),g(b,"class","scanex-wms-view-title"),g(n,"cellpadding","0"),g(n,"cellspacing","0"),g(n,"class","scanex-wms-view-header"),g(e,"class","layer")},m(l,a){s(l,e,a),r(e,n),r(n,o),r(o,c),r(c,i),r(o,u),A&&A.m(o,null),r(o,v),r(o,b),r(b,w),r(e,x),L&&L.m(e,null),k=!0,E=[m(i,"click",p(t[6])),m(n,"click",p(t[5]))]},p(t,[n]){8&n&&y(i,"check-square",1===t[3]),8&n&&y(i,"square",0===t[3]),8&n&&y(i,"minus-square",-1===t[3]),t[4]?A?A.p(t,n):(A=Q(t),A.c(),A.m(o,v)):A&&(A.d(1),A=null),(!k||2&n)&&$(w,t[1]),1&n&&(_=Array.isArray(t[0])&&t[0].length>0),_?L?(L.p(t,n),R(L,1)):(L=V(t),L.c(),R(L,1),L.m(e,null)):L&&(P(),X(L,1,1,()=>{L=null}),S())},i(t){k||(R(L),k=!0)},o(t){X(L),k=!1},d(t){t&&a(e),A&&A.d(),L&&L.d(),l(E)}}}function tt(t,e,n){let{title:o=""}=e,{name:l=""}=e,{children:c=[]}=e,{visible:i=!1}=e,r=!1,s=0;const a=x();function u(t,e){f&&(n(0,c[e].visible=t.visible,c),c.every(({visible:t})=>!0===t)?n(8,i=!0):c.every(({visible:t})=>!1===t)?n(8,i=!1):n(8,i=void 0),a("change:state",{title:o,name:l,visible:i}))}let f;return t.$set=t=>{"title"in t&&n(1,o=t.title),"name"in t&&n(9,l=t.name),"children"in t&&n(0,c=t.children),"visible"in t&&n(8,i=t.visible)},t.$$.update=()=>{if(257&t.$$.dirty&&(n(3,s=!0===i?1:!1===i?0:-1),Array.isArray(c)&&void 0!==i))for(let t=0;t<c.length;t++)n(0,c[t].visible=i,c),a("change:visible",{...c[t],visible:i});1&t.$$.dirty&&n(4,f=Array.isArray(c)&&c.length>0)},[c,o,r,s,f,function(){n(2,r=!r)},function(){n(8,i=!i),a("change:visible",{title:o,name:l,visible:i}),a("change:state",{title:o,name:l,visible:i})},u,i,l,a,function(e){k(t,e)},(t,{detail:e})=>u(e,t)]}class et extends W{constructor(t){super(),U(this,t,tt,Z,i,{title:1,name:9,children:0,visible:8})}}function nt(t,e,n){const o=t.slice();return o[5]=e[n],o}function ot(t){let n;const o=[t[5]];let l={};for(let t=0;t<o.length;t+=1)l=e(l,o[t]);const c=new et({props:l});return c.$on("change:visible",t[4]),{c(){F(c.$$.fragment)},m(t,e){G(c,t,e),n=!0},p(t,e){const n=2&e?z(o,[D(t[5])]):{};c.$set(n)},i(t){n||(R(c.$$.fragment,t),n=!0)},o(t){X(c.$$.fragment,t),n=!1},d(t){H(c,t)}}}function lt(t){let e,n,o,l,c,i,v,y,b,w,x=t[1],k=[];for(let e=0;e<x.length;e+=1)k[e]=ot(nt(t,x,e));const E=t=>X(k[t],1,1,()=>{k[t]=null});return{c(){e=f("div"),n=f("div"),o=f("label"),l=d(t[0]),c=h(),i=f("i"),v=h(),y=f("div");for(let t=0;t<k.length;t+=1)k[t].c();g(o,"class","title"),g(i,"class","icon close"),g(n,"class","header"),g(y,"class","content"),g(e,"class","scanex-wms-view-link")},m(a,u){s(a,e,u),r(e,n),r(n,o),r(o,l),r(n,c),r(n,i),r(e,v),r(e,y);for(let t=0;t<k.length;t+=1)k[t].m(y,null);b=!0,w=m(i,"click",p(t[3]))},p(t,[e]){if((!b||1&e)&&$(l,t[0]),2&e){let n;for(x=t[1],n=0;n<x.length;n+=1){const o=nt(t,x,n);k[n]?(k[n].p(o,e),R(k[n],1)):(k[n]=ot(o),k[n].c(),R(k[n],1),k[n].m(y,null))}for(P(),n=x.length;n<k.length;n+=1)E(n);S()}},i(t){if(!b){for(let t=0;t<x.length;t+=1)R(k[t]);b=!0}},o(t){k=k.filter(Boolean);for(let t=0;t<k.length;t+=1)X(k[t]);b=!1},d(t){t&&a(e),u(k,t),w()}}}function ct(t,e,n){let{title:o=""}=e,{layers:l=[]}=e;const c=x();return t.$set=t=>{"title"in t&&n(0,o=t.title),"layers"in t&&n(1,l=t.layers)},[o,l,c,()=>c("close"),function(e){k(t,e)}]}class it extends W{constructor(t){super(),U(this,t,ct,lt,i,{title:0,layers:1})}}function rt(e){let n,o,c,i,u,d;return{c(){n=f("div"),o=f("div"),c=f("input"),i=h(),u=f("div"),g(c,"class","url"),g(c,"type","text"),g(o,"class","header"),g(u,"class","links"),g(n,"class","scanex-wms-view")},m(t,l){s(t,n,l),r(n,o),r(o,c),v(c,e[0]),r(n,i),r(n,u),e[6](u),d=[m(c,"keydown",p(e[2])),m(c,"input",e[5])]},p(t,[e]){1&e&&c.value!==t[0]&&v(c,t[0])},i:t,o:t,d(t){t&&a(n),e[6](null),l(d)}}}function st(t){let e={};for(const n of t.children){const{name:t}=n;switch("Title"===t&&(e.title=n.value),t){case"Title":e.title=n.value;break;case"Name":e.name=n.value;break;case"Layer":e.children?e.children.push(st(n)):e.children=[st(n)]}}return e}function at(t,e,n){let o="";const l=new DOMParser;let c;async function i(t){try{const e=new XMLHttpRequest;e.addEventListener("load",()=>{if(200===e.status){const n=(t=>{const[e]=t.children;return J(e)})(e.responseXML);console.log(n);const{name:o,children:l}=n;if("WMS_Capabilities"===o){const e=l.reduce((t,e)=>("Capability"===e.name&&(t=t.concat(e.children.filter(t=>"Layer"===t.name).map(st))),t),[]);console.log(e);const n=new it({target:c,props:{layers:e,title:`${t}`}});n.$on("close",()=>n.$destroy()),n.$on("change:visible",({detail:t})=>{console.log(t)})}}else console.log(e)}),e.addEventListener("error",t=>{console.log(t)}),e.open("GET",`//maps.kosmosnimki.ru/proxy?${encodeURIComponent(t)}`),e.send()}catch(t){console.log(t)}}return[o,c,t=>{13===t.keyCode&&i(o)},l,i,function(){o=this.value,n(0,o)},function(t){_[t?"unshift":"push"](()=>{n(1,c=t)})}]}class ut extends W{constructor(t){super(),U(this,t,at,rt,i,{})}}window.addEventListener("load",()=>{new ut({target:document.body}).$on("change:visible",({detail:t})=>{console.log(t)})})}();
//# sourceMappingURL=main.js.map
