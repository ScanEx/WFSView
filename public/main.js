!function(){"use strict";function t(){}function e(t,e){for(const n in e)t[n]=e[n];return t}function n(t){return t()}function o(){return Object.create(null)}function s(t){t.forEach(n)}function l(t){return"function"==typeof t}function i(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function r(t,e){t.appendChild(e)}function c(t,e,n){t.insertBefore(e,n||null)}function a(t){t.parentNode.removeChild(t)}function u(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function f(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function m(){return d(" ")}function p(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function h(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function g(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function $(t,e){e=""+e,t.data!==e&&(t.data=e)}function y(t,e){(null!=e||t.value)&&(t.value=e)}function v(t,e,n){t.classList[n?"add":"remove"](e)}let b;function w(t){b=t}function x(){const t=function(){if(!b)throw new Error("Function called outside component initialization");return b}();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const s=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);o.slice().forEach(e=>{e.call(t,s)})}}}function E(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(t=>t(e))}const _=[],B=[],L=[],k=[],A=Promise.resolve();let C=!1;function R(t){L.push(t)}const N=new Set;function F(){do{for(;_.length;){const t=_.shift();w(t),P(t.$$)}for(;B.length;)B.pop()();for(let t=0;t<L.length;t+=1){const e=L[t];N.has(e)||(N.add(e),e())}L.length=0}while(_.length);for(;k.length;)k.pop()();C=!1,N.clear()}function P(t){if(null!==t.fragment){t.update(),s(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(R)}}const T=new Set;let q;function O(){q={r:0,c:[],p:q}}function X(){q.r||s(q.c),q=q.p}function M(t,e){t&&t.i&&(T.delete(t),t.i(e))}function S(t,e,n,o){if(t&&t.o){if(T.has(t))return;T.add(t),q.c.push(()=>{T.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}}function Y(t,e){const n={},o={},s={$$scope:1};let l=t.length;for(;l--;){const i=t[l],r=e[l];if(r){for(const t in i)t in r||(o[t]=1);for(const t in r)s[t]||(n[t]=r[t],s[t]=1);t[l]=r}else for(const t in i)s[t]=1}for(const t in o)t in n||(n[t]=void 0);return n}function D(t){return"object"==typeof t&&null!==t?t:{}}function j(t){t&&t.c()}function G(t,e,o){const{fragment:i,on_mount:r,on_destroy:c,after_update:a}=t.$$;i&&i.m(e,o),R(()=>{const e=r.map(n).filter(l);c?c.push(...e):s(e),t.$$.on_mount=[]}),a.forEach(R)}function I(t,e){const n=t.$$;null!==n.fragment&&(s(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function U(t,e){-1===t.$$.dirty[0]&&(_.push(t),C||(C=!0,A.then(F)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function z(e,n,l,i,r,c,a=[-1]){const u=b;w(e);const f=n.props||{},d=e.$$={fragment:null,ctx:null,props:c,update:t,not_equal:r,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:o(),dirty:a};let m=!1;d.ctx=l?l(e,f,(t,n,...o)=>{const s=o.length?o[0]:n;return d.ctx&&r(d.ctx[t],d.ctx[t]=s)&&(d.bound[t]&&d.bound[t](s),m&&U(e,t)),n}):[],d.update(),m=!0,s(d.before_update),d.fragment=!!i&&i(d.ctx),n.target&&(n.hydrate?d.fragment&&d.fragment.l(function(t){return Array.from(t.childNodes)}(n.target)):d.fragment&&d.fragment.c(),n.intro&&M(e.$$.fragment),G(e,n.target,n.anchor),F()),w(u)}class H{$destroy(){I(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}const W=(t,e,n)=>{const o=t.evaluate(n,e,()=>"http://www.opengis.net/wms",XPathResult.ANY_TYPE,null),s=[];let l;switch(o.resultType){case XPathResult.ANY_TYPE:break;case XPathResult.UNORDERED_NODE_ITERATOR_TYPE:for(l=o.iterateNext();l;)s.push(l),l=o.iterateNext()}return s},J=(t,e,n)=>{const o=W(t,e,n);return 1===o.length&&o[0].textContent||""},K=(t,e)=>({westBoundLongitude:parseFloat(J(t,e,"wms:westBoundLongitude")),eastBoundLongitude:parseFloat(J(t,e,"wms:eastBoundLongitude")),southBoundLatitude:parseFloat(J(t,e,"wms:southBoundLatitude")),northBoundLatitude:parseFloat(J(t,e,"wms:northBoundLatitude"))}),Q=(t,e)=>{const n=J(t,e,"wms:Title"),o=J(t,e,"wms:Name"),s=J(t,e,"wms:Abstract"),l=((t,e,n)=>{const o=W(t,e,n);return o.length>0&&o.map(t=>t.textContent)||[]})(t,e,"wms:CRS"),i=W(t,e,"wms:Layer").map(e=>Q(t,e)),r=W(t,e,"wms:EX_GeographicBoundingBox"),c=W(t,e,"wms:BoundingBox").map(e=>((t,e)=>({crs:J(t,e,"@CRS"),minx:parseFloat(J(t,e,"@minx")),miny:parseFloat(J(t,e,"@miny")),maxx:parseFloat(J(t,e,"@maxx")),maxy:parseFloat(J(t,e,"@maxy"))}))(t,e));return{title:n,name:o,abstract:s,crs:l,layers:i,exGeographicBoundingBox:r.length>0?K(t,r[0]):[],boundingBoxes:c}},V=t=>({capabilities:W(t,t,"/wms:WMS_Capabilities/wms:Capability").map(e=>((t,e)=>({layers:W(t,e,"wms:Layer").map(e=>Q(t,e))}))(t,e))});function Z(t,e,n){const o=t.slice();return o[13]=e[n],o[15]=n,o}function tt(t){let e,n;return{c(){e=f("td"),n=f("i"),g(n,"class","scanex-wms-view-folder icon"),v(n,"folder-open",t[2]),v(n,"folder",!t[2])},m(t,o){c(t,e,o),r(e,n)},p(t,e){4&e&&v(n,"folder-open",t[2]),4&e&&v(n,"folder",!t[2])},d(t){t&&a(e)}}}function et(t){let e,n,o=t[0],s=[];for(let e=0;e<o.length;e+=1)s[e]=nt(Z(t,o,e));const l=t=>S(s[t],1,1,()=>{s[t]=null});return{c(){e=f("div");for(let t=0;t<s.length;t+=1)s[t].c();g(e,"class","children"),v(e,"collapsed",!t[2])},m(t,o){c(t,e,o);for(let t=0;t<s.length;t+=1)s[t].m(e,null);n=!0},p(t,n){if(129&n){let i;for(o=t[0],i=0;i<o.length;i+=1){const l=Z(t,o,i);s[i]?(s[i].p(l,n),M(s[i],1)):(s[i]=nt(l),s[i].c(),M(s[i],1),s[i].m(e,null))}for(O(),i=o.length;i<s.length;i+=1)l(i);X()}4&n&&v(e,"collapsed",!t[2])},i(t){if(!n){for(let t=0;t<o.length;t+=1)M(s[t]);n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)S(s[t]);n=!1},d(t){t&&a(e),u(s,t)}}}function nt(t){let n;const o=[t[13]];let s={};for(let t=0;t<o.length;t+=1)s=e(s,o[t]);const l=new lt({props:s});return l.$on("change:visible",t[11]),l.$on("change:state",(function(...e){return t[12](t[15],...e)})),{c(){j(l.$$.fragment)},m(t,e){G(l,t,e),n=!0},p(e,n){t=e;const s=1&n?Y(o,[D(t[13])]):{};l.$set(s)},i(t){n||(M(l.$$.fragment,t),n=!0)},o(t){S(l.$$.fragment,t),n=!1},d(t){I(l,t)}}}function ot(t){let e,n,o,l,i,u,y,b,w,x,E,_,B=Array.isArray(t[0])&&t[0].length>0,L=t[4]&&tt(t),k=B&&et(t);return{c(){e=f("div"),n=f("table"),o=f("tr"),l=f("td"),i=f("i"),u=m(),L&&L.c(),y=m(),b=f("td"),w=d(t[1]),x=m(),k&&k.c(),g(i,"class","scanex-wms-view-visible icon"),v(i,"check-square",1===t[3]),v(i,"square",0===t[3]),v(i,"minus-square",-1===t[3]),g(b,"class","scanex-wms-view-title"),g(n,"cellpadding","0"),g(n,"cellspacing","0"),g(n,"class","scanex-wms-view-header"),g(e,"class","layer")},m(s,a){c(s,e,a),r(e,n),r(n,o),r(o,l),r(l,i),r(o,u),L&&L.m(o,null),r(o,y),r(o,b),r(b,w),r(e,x),k&&k.m(e,null),E=!0,_=[p(i,"click",h(t[6])),p(n,"click",h(t[5]))]},p(t,[n]){8&n&&v(i,"check-square",1===t[3]),8&n&&v(i,"square",0===t[3]),8&n&&v(i,"minus-square",-1===t[3]),t[4]?L?L.p(t,n):(L=tt(t),L.c(),L.m(o,y)):L&&(L.d(1),L=null),(!E||2&n)&&$(w,t[1]),1&n&&(B=Array.isArray(t[0])&&t[0].length>0),B?k?(k.p(t,n),M(k,1)):(k=et(t),k.c(),M(k,1),k.m(e,null)):k&&(O(),S(k,1,1,()=>{k=null}),X())},i(t){E||(M(k),E=!0)},o(t){S(k),E=!1},d(t){t&&a(e),L&&L.d(),k&&k.d(),s(_)}}}function st(t,e,n){let{title:o=""}=e,{name:s=""}=e,{layers:l=[]}=e,{visible:i=!1}=e,r=!1,c=0;const a=x();function u(t,e){f&&(n(0,l[e].visible=t.visible,l),l.every(({visible:t})=>!0===t)?n(8,i=!0):l.every(({visible:t})=>!1===t)?n(8,i=!1):n(8,i=void 0),a("change:state",{title:o,name:s,visible:i}))}let f;return t.$set=t=>{"title"in t&&n(1,o=t.title),"name"in t&&n(9,s=t.name),"layers"in t&&n(0,l=t.layers),"visible"in t&&n(8,i=t.visible)},t.$$.update=()=>{if(257&t.$$.dirty&&(n(3,c=!0===i?1:!1===i?0:-1),Array.isArray(l)&&void 0!==i))for(let t=0;t<l.length;t++)n(0,l[t].visible=i,l),a("change:visible",{...l[t],visible:i});1&t.$$.dirty&&n(4,f=Array.isArray(l)&&l.length>0)},[l,o,r,c,f,function(){n(2,r=!r)},function(){n(8,i=!i),a("change:visible",{title:o,name:s,visible:i}),a("change:state",{title:o,name:s,visible:i})},u,i,s,a,function(e){E(t,e)},(t,{detail:e})=>u(e,t)]}class lt extends H{constructor(t){super(),z(this,t,st,ot,i,{title:1,name:9,layers:0,visible:8})}}function it(t,e,n){const o=t.slice();return o[5]=e[n],o}function rt(t){let n;const o=[t[5]];let s={};for(let t=0;t<o.length;t+=1)s=e(s,o[t]);const l=new lt({props:s});return l.$on("change:visible",t[4]),{c(){j(l.$$.fragment)},m(t,e){G(l,t,e),n=!0},p(t,e){const n=2&e?Y(o,[D(t[5])]):{};l.$set(n)},i(t){n||(M(l.$$.fragment,t),n=!0)},o(t){S(l.$$.fragment,t),n=!1},d(t){I(l,t)}}}function ct(t){let e,n,o,s,l,i,y,v,b,w,x=t[1],E=[];for(let e=0;e<x.length;e+=1)E[e]=rt(it(t,x,e));const _=t=>S(E[t],1,1,()=>{E[t]=null});return{c(){e=f("div"),n=f("div"),o=f("label"),s=d(t[0]),l=m(),i=f("i"),y=m(),v=f("div");for(let t=0;t<E.length;t+=1)E[t].c();g(o,"class","title"),g(i,"class","icon close"),g(n,"class","header"),g(v,"class","content"),g(e,"class","scanex-wms-view-link")},m(a,u){c(a,e,u),r(e,n),r(n,o),r(o,s),r(n,l),r(n,i),r(e,y),r(e,v);for(let t=0;t<E.length;t+=1)E[t].m(v,null);b=!0,w=p(i,"click",h(t[3]))},p(t,[e]){if((!b||1&e)&&$(s,t[0]),2&e){let n;for(x=t[1],n=0;n<x.length;n+=1){const o=it(t,x,n);E[n]?(E[n].p(o,e),M(E[n],1)):(E[n]=rt(o),E[n].c(),M(E[n],1),E[n].m(v,null))}for(O(),n=x.length;n<E.length;n+=1)_(n);X()}},i(t){if(!b){for(let t=0;t<x.length;t+=1)M(E[t]);b=!0}},o(t){E=E.filter(Boolean);for(let t=0;t<E.length;t+=1)S(E[t]);b=!1},d(t){t&&a(e),u(E,t),w()}}}function at(t,e,n){let{title:o=""}=e,{layers:s=[]}=e;const l=x();return t.$set=t=>{"title"in t&&n(0,o=t.title),"layers"in t&&n(1,s=t.layers)},[o,s,l,()=>l("close"),function(e){E(t,e)}]}class ut extends H{constructor(t){super(),z(this,t,at,ct,i,{title:0,layers:1})}}function ft(e){let n,o,l,i,u,d;return{c(){n=f("div"),o=f("div"),l=f("input"),i=m(),u=f("div"),g(l,"class","url"),g(l,"type","text"),g(o,"class","header"),g(u,"class","links"),g(n,"class","scanex-wms-view")},m(t,s){c(t,n,s),r(n,o),r(o,l),y(l,e[0]),r(n,i),r(n,u),e[6](u),d=[p(l,"keydown",h(e[2])),p(l,"input",e[5])]},p(t,[e]){1&e&&l.value!==t[0]&&y(l,t[0])},i:t,o:t,d(t){t&&a(n),e[6](null),s(d)}}}function dt(t,e,n){let o="";const s=new DOMParser;let l;async function i(t){try{const e=new XMLHttpRequest;e.addEventListener("load",()=>{if(200===e.status){const n=V(e.responseXML),{capabilities:o}=n,{layers:s}=o[0],i=new ut({target:l,props:{layers:s,title:`${t}`}});i.$on("close",()=>i.$destroy()),i.$on("change:visible",({detail:t})=>{console.log(t)})}else console.log(e)}),e.addEventListener("error",t=>{console.log(t)}),e.open("GET",`//maps.kosmosnimki.ru/proxy?${encodeURIComponent(t)}`),e.send()}catch(t){console.log(t)}}return[o,l,t=>{13===t.keyCode&&i(o)},s,i,function(){o=this.value,n(0,o)},function(t){B[t?"unshift":"push"](()=>{n(1,l=t)})}]}class mt extends H{constructor(t){super(),z(this,t,dt,ft,i,{})}}window.addEventListener("load",()=>{new mt({target:document.body}).$on("change:visible",({detail:t})=>{console.log(t)})})}();
//# sourceMappingURL=main.js.map
